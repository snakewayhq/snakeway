[server]
# Address Snakeway listens on
listen = "0.0.0.0:8080"


[[routes]]
# Upstream service Snakeway proxies to
upstream = "127.0.0.1:3000"
path = "/"


[[routes]]
# Serves the contents of ./public from the path /static
# Requires the "static_files" feature to be enabled
file_dir = "./public/"
path = "/static"
index = false
directory_listing = false

# Caching header settings for the above static file route.
[routes.config]
cache_max_age = 86400
cache_public = true
cache_immutable = true

# ---------------------------------------------------------------------
# Identity
#
# Provides device and geo location information for subsequent devices.
# Support for EU compliance is best effort - use at your own risk.
#
# NOTE:
#   Devices are loaded and executed top-to-bottom.
#   This device must appear before structured_logging.
# ---------------------------------------------------------------------
[[devices]]
name = "identity"
kind = "builtin"
builtin = "identity"
enabled = false

enable_geoip = false
geoip_db = "some/path/file.mmdb"

enable_user_agent = false
ua_engine = "uaparser"

# CIDR ranges of trusted proxies for X-Forwarded-For parsing
trusted_proxies = []


# ---------------------------------------------------------------------
# Structured Logging Device
# ---------------------------------------------------------------------
[[devices]]
name = "access-log"
kind = "builtin"
builtin = "structured_logging"
enabled = true

level = "info"

# Whether to include HTTP headers in log events.
include_headers = false

# Header allow-list (case-insensitive).
# If empty, all headers are eligible.
allowed_headers = []

# Header names to redact if headers are included.
redact_headers = [
    "authorization",
    "cookie",
    "set-cookie",
    "x-api-token",
]

# Include EU-safe identity information
include_identity = true

# Allowed values: country, region, device, bot, asn
identity_fields = ["country", "device"]

events = ["request", "response"]
phases = ["request", "response"]



# ---------------------------------------------------------------------
# Builtin devices run in-process; WASM devices are sandboxed.
# ---------------------------------------------------------------------

[[devices]]
name = "example"
# WASM required the "wasm" feature.
# Enabling a WASM device without the feature enabled will cause a runtime error.
kind = "wasm"
path = "plugins/snakeway_wasm_example.wasm"
enabled = false