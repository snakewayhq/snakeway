[server]
# Address Snakeway listens on
listen = "0.0.0.0:8080"


[[routes]]
# Upstream service Snakeway proxies to
upstream = "127.0.0.1:3000"
path = "/"


[[routes]]
# Serves the contents of ./public from the path /static
# Requires the "static_files" feature to be enabled
file_dir = "./public/"
path = "/static"
index = false
directory_listing = false

# Caching header settings for the above static file route.
[routes.config]
cache_max_age = 86400
cache_public = true
cache_immutable = true

# ---------------------------------------------------------------------
# Devices are loaded and executed top-to-bottom.
# Builtin devices run in-process; WASM devices are sandboxed.
# ---------------------------------------------------------------------

[[devices]]
name = "example"
# WASM required the "wasm" feature.
# Enabling a WASM device without the feature enabled will cause a runtime error.
kind = "wasm"
path = "plugins/snakeway_wasm_example.wasm"
enabled = false


# ---------------------------------------------------------------------
# Structured Logging Device
#
# Emits structured tracing events for request/response lifecycle hooks.
# Output format (JSON vs pretty) is NOT controlled here — that is handled
# globally by tracing_subscriber and by the `snakeway logs` CLI.
# ---------------------------------------------------------------------

[[devices]]
name = "access-log"
kind = "builtin"
builtin = "structured_logging"
enabled = true

# Log level for events emitted by this device.
# This is independent of the global log filter.
#
# Allowed values:
#   "trace", "debug", "info", "warn", "error"
#
# Typical values:
#   - "info"  (default, production-safe)
#   - "debug" (local debugging)
level = "info"


# Whether to include HTTP headers in log events.
#
# WARNING:
#   Headers are often noisy and may contain sensitive data
#   (Authorization, Cookies, etc).
#
# Recommendation:
#   - false in production
#   - true only for debugging
include_headers = false


# Header names to redact if headers are included.
# Matching is case-insensitive.
#
# Redacted headers will appear as "<redacted>".
#
# This option is ignored unless `include_headers = true`.
redact_headers = [
    "authorization",
    "cookie",
    "set-cookie",
    "x-api-token",
]


# Which specific lifecycle events should emit logs.
#
# If omitted, ALL events are logged.
#
# Allowed values:
#   - "request"        (on_request)
#   - "before_proxy"  (before upstream call)
#   - "after_proxy"   (after upstream response)
#   - "response"      (before response is sent to client)
#
# Common patterns:
#   - ["request", "response"]  (access-log style)
#   - ["response"]             (minimal logging)
events = [
    "request",
    "response"
]


# High-level phases to log.
#
# This is a coarse filter that groups lifecycle hooks:
#
#   "request"  → on_request, before_proxy
#   "response" → after_proxy, on_response
#
# If omitted, ALL phases are enabled.
#
# This is useful for quickly reducing log volume without
# listing individual events.
phases = [
    "request",
    "response"
]
